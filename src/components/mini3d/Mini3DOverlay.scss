@use "../../styles/variables" as vars;

.mini3d-overlay {
  position: fixed;
  bottom: vars.$floating-panel-offset;
  left: vars.$floating-panel-offset;
  width: clamp(vars.$mini3d-width-min, 50vw, vars.$mini3d-width-max);
  height: clamp(vars.$mini3d-height-min, 50vh, vars.$mini3d-height-max);
  z-index: vars.$z-mini3d;
  cursor: pointer;
  touch-action: none;
  opacity: 0;
  transition: opacity var(--mini3d-open-fade-ms, 500ms) ease;
  will-change: opacity;
}

.mini3d-overlay.mini3d-overlay--opening,
.mini3d-overlay.mini3d-overlay--open {
  opacity: var(--mini3d-overlay-opacity, 0.85);
}

.mini3d-overlay.mini3d-overlay--closing {
  opacity: 0;
  transition-duration: var(--mini3d-close-fade-ms, 600ms);
  transition-timing-function: linear;
}

.mini3d-stage {
  position: absolute;
  inset: 0;
  overflow: hidden;
  perspective: var(--mini3d-perspective, 1200px);
  perspective-origin: 50% 50%;
  transform-style: preserve-3d;
}

.mini3d-world {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 0;
  height: 0;
  transform-style: preserve-3d;
  transform:
    translate3d(-50%, -50%, 0)
    translateZ(var(--mini3d-camera-z, -600px))
    scale(var(--mini3d-scale, 1))
    rotateX(var(--mini3d-pitch, 0.35rad))
    rotateY(var(--mini3d-yaw, -0.7853981634rad));
  will-change: transform;
}

.mini3d-item-shift {
  position: absolute;
  left: 0;
  top: 0;
  transform-style: preserve-3d;
}

.mini3d-item-shift--opening {
  animation: mini3d-converge-in 600ms cubic-bezier(0.22, 1, 0.36, 1) both;
  animation-delay: var(--mini3d-delay-ms, 0ms);
}

.mini3d-item-shift--closing {
  animation: mini3d-converge-out 600ms cubic-bezier(0.22, 1, 0.36, 1) both;
  animation-delay: var(--mini3d-delay-ms, 0ms);
}

.mini3d-box {
  position: absolute;
  left: 0;
  top: 0;
  transform-style: preserve-3d;
  transition: transform 220ms cubic-bezier(0.2, 0.9, 0.2, 1);
  will-change: transform;
}

.mini3d-face {
  position: absolute;
  left: 50%;
  top: 50%;
  box-sizing: border-box;
  backface-visibility: hidden;
  border: 1px solid rgba(0, 0, 0, 0.28);
}

.mini3d-face--front,
.mini3d-face--back {
  width: var(--mini3d-width);
  height: var(--mini3d-height);
}

.mini3d-face--right,
.mini3d-face--left {
  width: var(--mini3d-depth);
  height: var(--mini3d-height);
}

.mini3d-face--top,
.mini3d-face--bottom {
  width: var(--mini3d-width);
  height: var(--mini3d-depth);
}

.mini3d-face--front {
  background: var(--mini3d-front-color);
  transform: translate(-50%, -50%) translateZ(calc(var(--mini3d-depth) / 2));
}

.mini3d-face--back {
  background: var(--mini3d-back-color);
  transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--mini3d-depth) / 2));
}

.mini3d-face--right {
  background: var(--mini3d-right-color);
  transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--mini3d-width) / 2));
}

.mini3d-face--left {
  background: var(--mini3d-left-color);
  transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--mini3d-width) / 2));
}

.mini3d-face--top {
  background-color: var(--mini3d-top-color);
  background-image: var(--mini3d-top-image);
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc(var(--mini3d-height) / 2));
}

.mini3d-face--top::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, rgba(255, 255, 255, 0.16), rgba(0, 0, 0, 0.14));
  pointer-events: none;
}

.mini3d-face--bottom {
  background: var(--mini3d-bottom-color);
  transform: translate(-50%, -50%) rotateX(-90deg) translateZ(calc(var(--mini3d-height) / 2));
}

.mini3d-instruction {
  position: absolute;
  left: 8px;
  right: 8px;
  bottom: 8px;
  padding: 6px 8px;
  font-size: 12px;
  line-height: 1.3;
  text-align: center;
  color: #f5f5f5;
  background: rgba(0, 0, 0, 0.45);
  border-radius: 6px;
  pointer-events: none;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
}

@keyframes mini3d-converge-in {
  from {
    transform: translate3d(calc(var(--mini3d-conv-x, 0) * 1px), 0, calc(var(--mini3d-conv-z, 0) * 1px));
  }

  to {
    transform: translate3d(0, 0, 0);
  }
}

@keyframes mini3d-converge-out {
  from {
    transform: translate3d(0, 0, 0);
  }

  to {
    transform: translate3d(calc(var(--mini3d-conv-x, 0) * 1px), 0, calc(var(--mini3d-conv-z, 0) * 1px));
  }
}

@media (max-width: 768px) {
  .mini3d-overlay {
    bottom: vars.$floating-panel-offset-sm;
    left: vars.$floating-panel-offset-sm;
    width: clamp(vars.$mini3d-width-min-mobile, 35vw, vars.$mini3d-width-max-mobile);
    height: clamp(vars.$mini3d-height-min-mobile, 35vh, vars.$mini3d-height-max-mobile);
  }

  .mini3d-instruction {
    left: 6px;
    right: 6px;
    bottom: 6px;
    font-size: 11px;
  }
}

.mini3d-overlay.mini3d-overlay--fullscreen {
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  cursor: zoom-out;
}
